import requests
import streamlit as st

# Base API URL
BASE_URL = "http://web-api:4000/s/student"

# Page title
st.title("ðŸ‘¤ Student Profile")

# Form to input Student ID and Name
st.write("Enter your details:")
with st.form("profile_form"):
    student_id = st.text_input("Student ID", placeholder="Enter your Student ID")
    name = st.text_input("Name", placeholder="Enter your Name")
    submit = st.form_submit_button("Submit")

# Handle form submission
if submit:
    if not student_id or not name:
        st.error("Both Student ID and Name are required!")
    else:
        # Fetch or create student via API
        response = requests.post(
            f"{BASE_URL}/check_or_create",
            json={"StudentId": student_id, "Name": name},
        )

        if response.status_code in [200, 201]:
            student = response.json()
            st.success("Student details retrieved successfully!")
            st.write("### Student Information")
            st.write(f"**Student ID:** {student_id}")
            st.write(f"**Name:** {name}")
            st.write(f"**Email:** {student.get('Email', 'N/A')}")
            st.write(f"**Phone:** {student.get('Phone', 'N/A')}")
            st.write(f"**Year of Graduation:** {student.get('YOG', 'N/A')}")
            st.write(f"**Major:** {student.get('Major', 'N/A')}")
            st.write(f"**Advisor:** {student.get('Advisor', 'N/A')}")
        else:
            st.error("Error fetching or creating student. Please try again.")

# Handle edge cases for existing students
st.write("If your profile already exists, it will be fetched.")